(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/scan/peopleOrder/peopleOrder"],{307:function(e,t,n){"use strict";(function(e,t){var r=n(4);n(26);r(n(25));var o=r(n(308));e.__webpack_require_UNI_MP_PLUGIN__=n,t(o.default)}).call(this,n(1)["default"],n(2)["createPage"])},308:function(e,t,n){"use strict";n.r(t);var r=n(309),o=n(311);for(var a in o)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(a);n(313);var u,i=n(42),s=Object(i["default"])(o["default"],r["render"],r["staticRenderFns"],!1,null,"9ee00e54",null,!1,r["components"],u);s.options.__file="pages/scan/peopleOrder/peopleOrder.vue",t["default"]=s.exports},309:function(e,t,n){"use strict";n.r(t);var r=n(310);n.d(t,"render",(function(){return r["render"]})),n.d(t,"staticRenderFns",(function(){return r["staticRenderFns"]})),n.d(t,"recyclableRender",(function(){return r["recyclableRender"]})),n.d(t,"components",(function(){return r["components"]}))},310:function(e,t,n){"use strict";var r;n.r(t),n.d(t,"render",(function(){return o})),n.d(t,"staticRenderFns",(function(){return u})),n.d(t,"recyclableRender",(function(){return a})),n.d(t,"components",(function(){return r}));try{r={height:function(){return n.e("components/height/height").then(n.bind(null,768))},uIcon:function(){return Promise.all([n.e("common/vendor"),n.e("node-modules/uview-ui/components/u-icon/u-icon")]).then(n.bind(null,752))},expensedetail:function(){return n.e("components/expensedetail/expensedetail").then(n.bind(null,856))},uPicker:function(){return Promise.all([n.e("common/vendor"),n.e("node-modules/uview-ui/components/u-picker/u-picker")]).then(n.bind(null,952))},uPopup:function(){return Promise.all([n.e("common/vendor"),n.e("node-modules/uview-ui/components/u-popup/u-popup")]).then(n.bind(null,811))},paypopup:function(){return n.e("components/paypopup/paypopup").then(n.bind(null,906))}}}catch(i){if(-1===i.message.indexOf("Cannot find module")||-1===i.message.indexOf(".vue"))throw i;console.error(i.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var o=function(){var e=this,t=e.$createElement,n=(e._self._c,e.mkm(e.store_default_list.distance)),r=e.coupom_id.used_amount?null:e.coupon_list.length,o=e.order_list.data?e.order_list.data.length||0:null,a=e.remark2.length,u=e.mkm(e.store_default_list.distance),i=e.coupon_list.length,s=e.Httpimg?e.__map(e.coupon_list,(function(t,n){var r=e.__get_orig(t),o=e.temporary_coupom_ids.includes(t.id);return{$orig:r,g4:o}})):null;e._isMounted||(e.e0=function(t){e.show_time=!0},e.e1=function(t){e.coupon_list.length&&(e.coupon_show=!0)},e.e2=function(t){e.show_remark=!0},e.e3=function(t){e.zfShow&&e.setpType()},e.e4=function(t){e.zfShow&&e.btnBClick()},e.e5=function(t){e.show_time=!1},e.e6=function(t){e.show_time=!1},e.e7=function(t){e.show_remark=!1},e.e8=function(t){e.select_tableware=!1},e.e9=function(t){e.select_tableware=!1},e.e10=function(t){e.affirm=!1},e.e11=function(t){e.coupon_show=!1},e.e12=function(t){e.popShow=!1}),e.$mp.data=Object.assign({},{$root:{m0:n,g0:r,g1:o,g2:a,m1:u,g3:i,l0:s}})},a=!1,u=[];o._withStripped=!0},311:function(e,t,n){"use strict";n.r(t);var r=n(312),o=n.n(r);for(var a in r)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(a);t["default"]=o.a},312:function(e,t,n){"use strict";(function(e){var r=n(4);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=r(n(30)),a=r(n(18)),u=r(n(32)),i=r(n(35)),s=n(180),c=r(n(38)),d=(n(36),n(39)),p=n(33),l={data:function(){return{Httpimg:i.default.HttpImg,temporary_coupom_id:{},temporary_coupom_ids:[],remark2:"",orderNo:"",pageurl:"",popShow:!1,scene:e.getStorageSync("scene")||null,tsShow:!1,dbshow:!0,select_count:2,phone:"",show_time:!1,columns:[["立即就餐","11:30","12:00","12:50"]],columns_value:"立即就餐",show_remark:!1,remark:"",select_tableware:!1,tableware:[["无需餐具","一份餐具","两份餐具","三份餐具"]],tableware_value:"",affirm:!1,coupon_show:!1,order_list:{},store_default_list:{},address_data:{},coupon_list:[],coupom_id:{},display:!1,zfShow:!0,type:1,order:!1,pType:1,ctype:1,peopleCount:0}},computed:{shopid:function(){return e.getStorageSync("shop")},select:function(){return e.getStorageSync("option")}},onLoad:function(t){t.ctype&&(this.ctype=t.ctype),this.peopleCount=t.peopleCount,this.tableware_value="".concat(this.peopleCount,"人份"),this.getcode(),this.select_count=e.getStorageSync("option"),this.order_carListApi(),this.order_tablewareApi(),t.query&&t.query.item&&(this.address_data=JSON.parse(t.query.item))},onShow:function(){var e=getCurrentPages(),t=e[e.length-1];t.$item&&(this.address_data=JSON.parse(t.$item))},methods:{confirmCoupon:function(){this.coupom_id=this.temporary_coupom_id,this.coupon_show=!1,this.order_carListApi()},choosecoupon:function(e){this.temporary_coupom_ids.includes(e.id)&&this.temporary_coupom_ids[0]==e.id?(this.temporary_coupom_id={},this.temporary_coupom_ids=[]):(this.temporary_coupom_id=e,this.temporary_coupom_ids=[e.id])},getcode:function(){return(0,u.default)(o.default.mark((function e(){var t,n;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,d.userInfo)();case 2:if(t=e.sent,""!=t.data.openid){e.next=9;break}return e.next=6,c.default.loginApi();case 6:return n=e.sent,e.next=9,(0,p.user_binding)({code:n.code});case 9:case"end":return e.stop()}}),e)})))()},setpType:function(){var t=this;return(0,u.default)(o.default.mark((function n(){var r,a;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=e.getStorageSync("peopleCount")||1,n.next=3,(0,s.order_create)({orderType:3,storeId:t.store_default_list.id,subscribeTime:t.columns_value,subscribeTel:t.phone,serviceTime:t.columns_value,addressId:t.address_data.id,remark:t.remark,couponId:t.coupom_id.id,tablewareCount:t.tableware_value||"无需餐具",type:t.type,seatId:t.scene?[t.scene]:"",pType:2,peopleCount:r,c_type:t.ctype||1});case 3:a=n.sent,1==a.code&&e.reLaunch({url:"/pages/order_form/order_form?idx=2&pageShow=2"});case 5:case"end":return n.stop()}}),n)})))()},payConfirm:function(){1==this.select?this.pick_up_store():this.TakeoutOrder()},routergo:function(t){e.navigateTo({url:t})},rule:function(e){this.coupon_list[e].show?this.coupon_list[e].show=0:this.coupon_list[e].show=1},confirm:function(e){this.columns_value=e.value[0],this.show_time=!1},changeHandler:function(e){this.columns_value=e.value[0]},confirm_remarks:function(){this.remark=this.remark2,this.show_remark=!1},select_tableware_confirm:function(e){this.select_tableware=!1,this.tableware_value=e.value[0]},select_tableware_changeHandler:function(e){this.tableware_value=e.value[0]},btnBClick:function(){e.$u.throttle(this.submit,1e3)},binding:function(e,t){return(0,u.default)(o.default.mark((function e(){return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},TakeoutOrder:function(){var t=this;return(0,u.default)(o.default.mark((function n(){var r,a,u,i;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=e.getStorageSync("peopleCount")||1,n.next=3,(0,s.order_create)({orderType:e.getStorageSync("option"),storeId:t.store_default_list.id,subscribeTime:t.columns_value,subscribeTel:t.phone,serviceTime:t.columns_value,addressId:t.address_data.id,remark:t.remark,couponId:t.coupom_id.id,tablewareCount:t.tableware_value||"无需餐具",type:t.type,seatId:t.scene?[t.scene]:"",Type:t.pType,peopleCount:r,c_type:t.ctype||1});case 3:if(a=n.sent,1!=a.code){n.next=12;break}return u=e.getStorageSync("openid")||"",n.next=8,(0,s.order_pay)({orderNo:a.data.orderNo,openid:u});case 8:i=n.sent,1==i.code?(t.scene?t.pageurl="/pages/order_form/order_form?idx=2":t.pageurl="/pages/order_form/order_form?idx=1",t.affirm=!1,t.orderNo=a.data.orderNo,t.popShow=!0,t.dbshow=!0,t.order=!0):e.showToast({title:i.msg,icon:"none"}),n.next=13;break;case 12:e.showToast({title:a.msg,icon:"none"});case 13:case"end":return n.stop()}}),n)})))()},submit:function(){var t=this;return(0,u.default)(o.default.mark((function n(){var r,a,u,i;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(1!=e.getStorageSync("option")){n.next=14;break}if(r=/^1[3-9]\d{9}$/,a=r.test(t.phone),!a){n.next=6;break}n.next=8;break;case 6:return e.showToast({title:"请正确输入手机号",icon:"none"}),n.abrupt("return");case 8:if(!(t.phone.length<11)){n.next=11;break}return e.showToast({title:"请正确输入手机号",icon:"none"}),n.abrupt("return");case 11:t.affirm=!0,n.next=28;break;case 14:if(2!=e.getStorageSync("option")){n.next=27;break}return n.next=17,(0,d.userInfo)();case 17:if(u=n.sent,""!=u.data.openid){n.next=24;break}return n.next=21,c.default.loginApi();case 21:return i=n.sent,n.next=24,(0,p.user_binding)({code:i.code});case 24:t.address_data.address?t.popShow=!0:e.$showMsg("请选择收货地址"),n.next=28;break;case 27:t.popShow=!0;case 28:case"end":return n.stop()}}),n)})))()},dbClick:function(){this.setpopShow(),this.dbshow=!1},setpopShow:function(){this.popShow=!0,this.zfShow=!1,this.affirm=!1},pick_up_store:function(){var t=this;return(0,u.default)(o.default.mark((function n(){var r,a,u,i;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,(0,d.userInfo)();case 2:if(r=n.sent,""!=r.data.openid){n.next=9;break}return n.next=6,c.default.loginApi();case 6:return a=n.sent,n.next=9,(0,p.user_binding)({code:a.code});case 9:return u=e.getStorageSync("peopleCount")||1,n.next=12,(0,s.order_create)({orderType:e.getStorageSync("option"),storeId:t.store_default_list.id,subscribeTime:t.columns_value,subscribeTel:t.phone,serviceTime:t.columns_value,addressId:t.address_data.id,remark:t.remark,couponId:t.coupom_id.id,tablewareCount:t.tableware_value,peopleCount:u,c_type:t.ctype||1});case 12:i=n.sent,1==i.code?(t.orderNo=i.data.orderNo,t.pageurl="/pages/order_form/order_form?idx=0",t.dbshow=!0,t.order=!0):e.showToast({title:i.msg,icon:"none"});case 14:case"end":return n.stop()}}),n)})))()},order_carListApi:function(){var t=this;return(0,u.default)(o.default.mark((function n(){var r,a,u,i;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(a=e.getStorageSync("peopleCount")||0,u=e.getStorageSync("scene")||"",i=e.getStorageSync("currentShop").iscwf,1!=i){n.next=9;break}return n.next=6,(0,s.order_carList)({coupon_id:t.coupom_id.id,peopleCount:a,store_id:t.shopid,c_type:t.ctype,seat_id:u});case 6:r=n.sent,n.next=12;break;case 9:return n.next=11,(0,s.order_carList)({coupon_id:t.coupom_id.id,store_id:t.shopid,c_type:t.ctype,seat_id:u});case 11:r=n.sent;case 12:1==r.code&&(t.order_list=r.data,t.store_defaultApi(),r.data.total>0&&t.coupon_usableApi());case 13:case"end":return n.stop()}}),n)})))()},store_defaultApi:function(){var e=this;return(0,u.default)(o.default.mark((function t(){var n,r,u,i;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,(0,s.store_default)({id:null===(n=e.order_list)||void 0===n||null===(r=n.data[0])||void 0===r?void 0:r.store_id});case 2:i=t.sent,e.columns[0]=[],(u=e.columns[0]).push.apply(u,(0,a.default)(i.data.time)),e.store_default_list=i.data,e.display=!0;case 7:case"end":return t.stop()}}),t)})))()},coupon_usableApi:function(){var e=this;return(0,u.default)(o.default.mark((function t(){var n,r;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,(0,s.coupon_usable)({price:e.order_list.total});case 2:r=t.sent,e.coupon_list=[],(n=e.coupon_list).push.apply(n,(0,a.default)(null===r||void 0===r?void 0:r.data));case 5:case"end":return t.stop()}}),t)})))()},order_tablewareApi:function(){var e=this;return(0,u.default)(o.default.mark((function t(){var n,r;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,(0,s.order_tableware)();case 2:r=t.sent,e.tableware[0]=[],(n=e.tableware[0]).push.apply(n,(0,a.default)(r.data.tableware));case 5:case"end":return t.stop()}}),t)})))()},selective_offer:function(e){this.coupom_id=e,this.coupon_show=!1,this.order_carListApi()}}};t.default=l}).call(this,n(2)["default"])},313:function(e,t,n){"use strict";n.r(t);var r=n(314),o=n.n(r);for(var a in r)["default"].indexOf(a)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(a);t["default"]=o.a},314:function(e,t,n){}},[[307,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../../.sourcemap/mp-weixin/pages/scan/peopleOrder/peopleOrder.js.map