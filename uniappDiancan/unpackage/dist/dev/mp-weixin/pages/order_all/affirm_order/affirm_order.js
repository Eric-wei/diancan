require('../common/vendor.js');(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order_all/affirm_order/affirm_order"],{661:function(e,t,n){"use strict";(function(e,t){var o=n(4);n(26);o(n(25));var r=o(n(662));e.__webpack_require_UNI_MP_PLUGIN__=n,t(r.default)}).call(this,n(1)["default"],n(2)["createPage"])},662:function(e,t,n){"use strict";n.r(t);var o=n(663),r=n(665);for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i);n(667),n(669);var s,a=n(42),u=Object(a["default"])(r["default"],o["render"],o["staticRenderFns"],!1,null,"5c301432",null,!1,o["components"],s);u.options.__file="pages/order_all/affirm_order/affirm_order.vue",t["default"]=u.exports},663:function(e,t,n){"use strict";n.r(t);var o=n(664);n.d(t,"render",(function(){return o["render"]})),n.d(t,"staticRenderFns",(function(){return o["staticRenderFns"]})),n.d(t,"recyclableRender",(function(){return o["recyclableRender"]})),n.d(t,"components",(function(){return o["components"]}))},664:function(e,t,n){"use strict";var o;n.r(t),n.d(t,"render",(function(){return r})),n.d(t,"staticRenderFns",(function(){return s})),n.d(t,"recyclableRender",(function(){return i})),n.d(t,"components",(function(){return o}));try{o={uNavbar:function(){return Promise.all([n.e("common/vendor"),n.e("node-modules/uview-ui/components/u-navbar/u-navbar")]).then(n.bind(null,974))},height:function(){return n.e("components/height/height").then(n.bind(null,768))},Select2:function(){return n.e("components/Select2/Select2").then(n.bind(null,1119))},uIcon:function(){return Promise.all([n.e("common/vendor"),n.e("node-modules/uview-ui/components/u-icon/u-icon")]).then(n.bind(null,752))},expensedetail:function(){return n.e("components/expensedetail/expensedetail").then(n.bind(null,856))},uPicker:function(){return Promise.all([n.e("common/vendor"),n.e("node-modules/uview-ui/components/u-picker/u-picker")]).then(n.bind(null,952))},uPopup:function(){return Promise.all([n.e("common/vendor"),n.e("node-modules/uview-ui/components/u-popup/u-popup")]).then(n.bind(null,811))},paypopup:function(){return n.e("components/paypopup/paypopup").then(n.bind(null,906))},uModal:function(){return Promise.all([n.e("common/vendor"),n.e("node-modules/uview-ui/components/u-modal/u-modal")]).then(n.bind(null,898))}}}catch(a){if(-1===a.message.indexOf("Cannot find module")||-1===a.message.indexOf(".vue"))throw a;console.error(a.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var r=function(){var e=this,t=e.$createElement,n=(e._self._c,e.scene||1!=e.select?null:e.mkm(e.store_default_list.distance)),o=1!=e.select||e.coupom_id.used_amount?null:e.coupon_list.length,r=e.order_list.data?e.order_list.data.length||0:null,i=1==e.select||3==e.select||e.coupom_id.used_amount?null:e.coupon_list.length,s=2==e.select?(1*e.order_list.after_total+1*e.order_list.db_price+1*e.order_list.ps_price).toFixed(2):null,a=e.remark.length,u=e.mkm(e.store_default_list.distance),c=e.coupon_list.length,d=e.Httpimg?e.__map(e.coupon_list,(function(t,n){var o=e.__get_orig(t),r=e.temporary_coupom_ids.includes(t.id);return{$orig:o,g6:r}})):null;e._isMounted||(e.e0=function(t){e.show_time=!0},e.e1=function(t){e.show_time=!0},e.e2=function(t){e.coupon_list.length&&(e.coupon_show=!0)},e.e3=function(t){t.stopPropagation(),e.psshow=!1,e.dbfshow=!1},e.e4=function(t){t.stopPropagation(),e.psshow=!1,e.dbfshow=!1},e.e5=function(t){t.stopPropagation(),e.dbfshow=!e.dbfshow,e.psshow=!1},e.e6=function(t){t.stopPropagation(),e.psshow=!1,e.dbfshow=!1},e.e7=function(t){t.stopPropagation(),e.psshow=!e.psshow,e.dbfshow=!1},e.e8=function(t){e.coupon_list.length&&(e.coupon_show=!0)},e.e9=function(t){e.select_tableware=!0},e.e10=function(t){e.show_remark=!0},e.e11=function(t){e.zfShow&&e.btnBClick()},e.e12=function(t){e.show_time=!1},e.e13=function(t){e.show_time=!1},e.e14=function(t){e.show_remark=!1},e.e15=function(t){e.select_tableware=!1},e.e16=function(t){e.select_tableware=!1},e.e17=function(t){e.affirm=!1},e.e18=function(t){e.coupon_show=!1},e.e19=function(t){e.popShow=!1}),e.$mp.data=Object.assign({},{$root:{m0:n,g0:o,g1:r,g2:i,g3:s,g4:a,m1:u,g5:c,l0:d}})},i=!1,s=[];r._withStripped=!0},665:function(e,t,n){"use strict";n.r(t);var o=n(666),r=n.n(o);for(var i in o)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(i);t["default"]=r.a},666:function(e,t,n){"use strict";(function(e){var o=n(4);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=o(n(30)),i=o(n(18)),s=o(n(32)),a=o(n(35)),u=n(180),c=o(n(38)),d=(n(36),n(39)),l=n(33),p={data:function(){return{tipshow:!1,Httpimg:a.default.HttpImg,tiptitle:"温馨提示",tipcontent:"当前店铺不支持外卖,请重新下单",orderNo:"",pageurl:"",popShow:!1,scene:e.getStorageSync("scene")||null,tsShow:!1,dbshow:!0,dbfshow:!1,select_count:2,phone:"",show_time:!1,columns:[[]],columns_value:"",show_remark:!1,remark:"",select_tableware:!1,tableware:[["无需餐具","一份餐具","两份餐具","三份餐具"]],tableware_value:"无需餐具",affirm:!1,coupon_show:!1,order_list:{},store_default_list:{},address_data:{},coupon_list:[],coupom_id:{},temporary_coupom_id:{},temporary_coupom_ids:[],display:!1,zfShow:!0,type:1,order:!1,store_default_data:{},psshow:!1,addressshow:!1,ctype:1}},computed:{select:function(){return e.getStorageSync("option")},shopid:function(){return e.getStorageSync("shop")},public:function(){return e.getStorageSync("public")}},onLoad:function(t){this.select_count=e.getStorageSync("option"),t.ctype&&(this.ctype=2),this.order_tablewareApi(),2==this.select_count&&this.getDefaultAddressApi(),this.order_carListApi(),t.query&&t.query.item&&(this.address_data=JSON.parse(t.query.item))},onShow:function(){var e=getCurrentPages(),t=e[e.length-1];console.log(t.$item,"获取的地址数据"),t.$item&&(this.address_data=JSON.parse(t.$item))},methods:{closeaddress:function(){this.addressshow=!1},rightClick:function(){var t=getCurrentPages();1==t.length?e.reLaunch({url:"/pages/index/index"}):e.navigateBack(),console.log("点击了")},confirmCoupon:function(){this.coupom_id=this.temporary_coupom_id,this.coupon_show=!1,this.order_carListApi()},choosecoupon:function(e){this.temporary_coupom_ids.includes(e.id)&&this.temporary_coupom_ids[0]==e.id?(this.temporary_coupom_id={},this.temporary_coupom_ids=[]):(this.temporary_coupom_id=e,this.temporary_coupom_ids=[e.id])},getDefaultAddressApi:function(){var e=this;return(0,s.default)(r.default.mark((function t(){var n;return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,(0,u.getDefaultAddress)({store_id:e.shopid||""});case 2:n=t.sent,1==n.code&&(e.address_data=n.data);case 4:case"end":return t.stop()}}),t)})))()},getmgs:function(t){this.select_count=t,e.setStorageSync("option",t)},getswitch:function(){var t=e.getStorageSync("option");if(1==t){if(1!==this.store_default_list.delivery_switch)return this.tipcontent="当前店铺不支持自提,请重新下单",void(this.tipshow=!0)}else if(1!==this.store_default_list.takeaway_switch)return void(this.tipshow=!0)},payConfirm:function(){1==this.select?e.$u.throttle(this.pick_up_store,1e3):e.$u.throttle(this.TakeoutOrder,1e3)},routergo:function(t){e.navigateTo({url:t})},rule:function(t){this.coupon_list[t].remarks?this.coupon_list[t].show?this.coupon_list[t].show=0:this.coupon_list[t].show=1:e.showToast({title:"无使用规则",icon:"none"})},confirm:function(e){this.columns_value=e.value[0],this.show_time=!1},changeHandler:function(e){this.columns_value=e.value[0]},confirm_remarks:function(){this.show_remark=!1},select_tableware_confirm:function(e){this.select_tableware=!1,this.tableware_value=e.value[0]},select_tableware_changeHandler:function(e){this.tableware_value=e.value[0]},btnBClick:function(){e.$u.throttle(this.submit,1e3)},binding:function(e,t){return(0,s.default)(r.default.mark((function e(){return r.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},TakeoutOrder:function(){var t=this;return(0,s.default)(r.default.mark((function n(){var o,i;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return o=e.getStorageSync("peopleCount")||0,n.next=3,(0,u.order_create)({orderType:e.getStorageSync("option"),storeId:t.store_default_list.id,subscribeTime:t.columns_value,subscribeTel:t.phone,serviceTime:t.columns_value,addressId:t.address_data.id,remark:t.remark,couponId:t.coupom_id.id,tablewareCount:t.tableware_value||"无需餐具",type:t.type,seatId:t.scene?t.scene:"",peopleCount:o});case 3:i=n.sent,1==i.code?(t.scene,t.pageurl="/pages/order_form/order_form?tabidx=0",console.log("this.page",t.pageurl),t.affirm=!1,t.orderNo=i.data.orderNo,t.popShow=!0,t.dbshow=!0,t.order=!0):e.showToast({title:i.msg,icon:"none"});case 5:case"end":return n.stop()}}),n)})))()},submit:function(){var t=this;return(0,s.default)(r.default.mark((function n(){var o,i,s,a;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(1!=e.getStorageSync("option")){n.next=14;break}if(o=/^1[3-9]\d{9}$/,i=o.test(t.phone),!i){n.next=6;break}n.next=8;break;case 6:return e.showToast({title:"请正确输入手机号",icon:"none"}),n.abrupt("return");case 8:if(!(t.phone.length<11)){n.next=11;break}return e.showToast({title:"请正确输入手机号",icon:"none"}),n.abrupt("return");case 11:t.affirm=!0,n.next=28;break;case 14:if(2!=e.getStorageSync("option")){n.next=27;break}return n.next=17,(0,d.userInfo)();case 17:if(s=n.sent,""!=s.data.openid){n.next=24;break}return n.next=21,c.default.loginApi();case 21:return a=n.sent,n.next=24,(0,l.user_binding)({code:a.code});case 24:t.address_data.address?t.popShow=!0:e.$showMsg("请选择收货地址"),n.next=28;break;case 27:t.popShow=!0;case 28:case"end":return n.stop()}}),n)})))()},dbClick:function(){this.setpopShow(),this.dbshow=!1},setpopShow:function(){var e=this;this.popShow=!0,this.zfShow=!1,this.affirm=!1,setTimeout((function(){e.dbshow=!0,e.zfShow=!0}),1e3)},pick_up_store:function(){var t=this;return(0,s.default)(r.default.mark((function n(){var o,i,s,a;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,(0,d.userInfo)();case 2:if(o=n.sent,""!=o.data.openid){n.next=9;break}return n.next=6,c.default.loginApi();case 6:return i=n.sent,n.next=9,(0,l.user_binding)({code:i.code});case 9:return s=e.getStorageSync("peopleCount")||0,n.next=12,(0,u.order_create)({orderType:e.getStorageSync("option"),storeId:t.store_default_list.id,subscribeTime:t.columns_value,subscribeTel:t.phone,serviceTime:t.columns_value,addressId:t.address_data.id,remark:t.remark,couponId:t.coupom_id.id,tablewareCount:t.tableware_value,peopleCount:s});case 12:a=n.sent,1==a.code?(t.orderNo=a.data.orderNo,t.pageurl="/pages/order_form/order_form?tabidx=0",t.dbshow=!0,t.order=!0):e.showToast({title:a.msg,icon:"none"});case 14:case"end":return n.stop()}}),n)})))()},order_carListApi:function(){var t=this;return(0,s.default)(r.default.mark((function n(){var o,i,s;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return i=t,s=e.getStorageSync("peopleCount")||0,console.log(s,"peopleCount"),e.getStorageSync("currentShop").iscwf,n.next=6,(0,u.order_carList)({seat_id:i.scene||"",coupon_id:i.coupom_id.id,store_id:i.shopid||"",c_type:i.ctype,peopleCount:s||""});case 6:o=n.sent,1==o.code&&(t.order_list=o.data,t.store_defaultApi(),o.data.total>0&&t.coupon_usableApi());case 8:case"end":return n.stop()}}),n)})))()},store_defaultApi:function(){var e=this;return(0,s.default)(r.default.mark((function t(){var n,o,s,a;return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,(0,u.store_default)({id:null===(n=e.order_list)||void 0===n||null===(o=n.data[0])||void 0===o?void 0:o.store_id});case 2:s=t.sent,1==s.code&&(e.columns[0]=[],(a=e.columns[0]).push.apply(a,(0,i.default)(s.data.time)),e.store_default_list=s.data,e.getswitch(),e.display=!0);case 4:case"end":return t.stop()}}),t)})))()},coupon_usableApi:function(){var e=this;return(0,s.default)(r.default.mark((function t(){var n,o;return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,(0,u.coupon_usable)({price:e.order_list.total});case 2:n=t.sent,1==n.code&&(e.coupon_list=[],(o=e.coupon_list).push.apply(o,(0,i.default)(null===n||void 0===n?void 0:n.data)));case 4:case"end":return t.stop()}}),t)})))()},order_tablewareApi:function(){var e=this;return(0,s.default)(r.default.mark((function t(){var n,o;return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,(0,u.order_tableware)();case 2:o=t.sent,e.tableware[0]=[],(n=e.tableware[0]).push.apply(n,(0,i.default)(o.data.tableware));case 5:case"end":return t.stop()}}),t)})))()},selective_offer:function(e){this.coupom_id=e,this.coupon_show=!1,this.order_carListApi()}}};t.default=p}).call(this,n(2)["default"])},667:function(e,t,n){"use strict";n.r(t);var o=n(668),r=n.n(o);for(var i in o)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(i);t["default"]=r.a},668:function(e,t,n){},669:function(e,t,n){"use strict";n.r(t);var o=n(670),r=n.n(o);for(var i in o)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(i);t["default"]=r.a},670:function(e,t,n){}},[[661,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../../.sourcemap/mp-weixin/pages/order_all/affirm_order/affirm_order.js.map